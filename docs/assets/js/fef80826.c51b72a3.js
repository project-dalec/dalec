"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1670],{8282:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"verifying-images","title":"Verifying Release Images","description":"All official Dalec container images are cryptographically signed and include attestations for build provenance. This guide explains how to verify you\'re using authentic, unmodified Dalec releases.","source":"@site/docs/verifying-images.md","sourceDirName":".","slug":"/verifying-images","permalink":"/dalec/verifying-images","draft":false,"unlisted":false,"editUrl":"https://github.com/project-dalec/dalec/blob/main/website/docs/verifying-images.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Editor Support","permalink":"/dalec/editor-support"},"next":{"title":"Dalec Architecture","permalink":"/dalec/architecture"}}');var t=n(4848),r=n(8453);const a={},c="Verifying Release Images",l={},o=[{value:"When to Verify",id:"when-to-verify",level:2},{value:"Why Verify Images?",id:"why-verify-images",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"What Gets Signed",id:"what-gets-signed",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Option 1: Cosign (Recommended)",id:"option-1-cosign-recommended",level:3},{value:"Option 2: GitHub CLI",id:"option-2-github-cli",level:3},{value:"Verifying Image Signatures",id:"verifying-image-signatures",level:2},{value:"Verify Frontend Image",id:"verify-frontend-image",level:3},{value:"Verify Worker Images",id:"verify-worker-images",level:3},{value:"Understanding the Output",id:"understanding-the-output",level:3},{value:"Verifying Build Provenance",id:"verifying-build-provenance",level:2},{value:"View Provenance Attestation",id:"view-provenance-attestation",level:3},{value:"Viewing SBOM (Software Bill of Materials)",id:"viewing-sbom-software-bill-of-materials",level:3},{value:"Automated Verification in CI/CD",id:"automated-verification-in-cicd",level:2},{value:"GitHub Actions Example",id:"github-actions-example",level:3},{value:"GitLab CI Example",id:"gitlab-ci-example",level:3},{value:"Best Practices",id:"best-practices",level:3},{value:"Development vs. Release Images",id:"development-vs-release-images",level:2},{value:"Additional Resources",id:"additional-resources",level:2}];function d(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.header,{children:(0,t.jsx)(i.h1,{id:"verifying-release-images",children:"Verifying Release Images"})}),"\n",(0,t.jsx)(i.p,{children:"All official Dalec container images are cryptographically signed and include attestations for build provenance. This guide explains how to verify you're using authentic, unmodified Dalec releases."}),"\n",(0,t.jsx)(i.h2,{id:"when-to-verify",children:"When to Verify"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"You should verify Dalec images before using them to build your packages"}),", especially if:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"You're using Dalec in production or CI/CD pipelines"}),"\n",(0,t.jsx)(i.li,{children:"Your organization has security policies requiring verified software"}),"\n",(0,t.jsx)(i.li,{children:"You want to ensure you're not using a compromised version of Dalec"}),"\n",(0,t.jsx)(i.li,{children:"You need an audit trail showing what versions of Dalec were used"}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.strong,{children:"How Dalec images are used:"})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["When you run ",(0,t.jsx)(i.code,{children:"docker build"})," with a Dalec spec, Docker automatically pulls the Dalec frontend image (",(0,t.jsx)(i.code,{children:"ghcr.io/project-dalec/dalec/frontend"}),") to process your build"]}),"\n",(0,t.jsx)(i.li,{children:"You typically don't interact with these images directly - Docker handles them behind the scenes"}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"However"}),", you should verify them before your first use or when updating to a new version"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"why-verify-images",children:"Why Verify Images?"}),"\n",(0,t.jsx)(i.p,{children:"Image verification provides several security benefits:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Authenticity"}),": Confirm the image was published by the official Dalec repository, not an attacker"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Integrity"}),": Detect if the image has been tampered with after publishing"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Provenance"}),": Verify the image was built from the expected source code and official workflow"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Supply Chain Security"}),": Meet security best practices and compliance requirements (e.g., SLSA framework)"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Audit Trail"}),": Document which verified versions of Dalec were used to build your packages"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,t.jsx)(i.p,{children:"Here's a simple workflow for verifying Dalec before using it:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"# 1. Install cosign (one-time setup)\nbrew install cosign\nexport VERSION=v0.19.0\n\n# 2. Before using Dalec, verify the frontend image\ncosign verify ghcr.io/project-dalec/dalec/frontend:$VERSION \\\n  --certificate-oidc-issuer https://token.actions.githubusercontent.com \\\n  --certificate-identity https://github.com/project-dalec/dalec/.github/workflows/frontend-image.yml@refs/tags/$VERSION\n\n# 3. If verification succeeds, you can safely use Dalec\ndocker build -f my-spec.yml --target mariner2/rpm .\n"})}),"\n",(0,t.jsxs)(i.p,{children:["If verification fails, ",(0,t.jsx)(i.strong,{children:"do not use that image"})," - it may be compromised or unofficial."]}),"\n",(0,t.jsx)(i.h2,{id:"what-gets-signed",children:"What Gets Signed"}),"\n",(0,t.jsx)(i.p,{children:"The following container images are signed when published as releases:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Frontend image"}),": ",(0,t.jsx)(i.code,{children:"ghcr.io/project-dalec/dalec/frontend"})," - The main BuildKit frontend that processes your Dalec spec files"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Worker images"}),": Target-specific images like ",(0,t.jsx)(i.code,{children:"ghcr.io/project-dalec/dalec/noble/worker"})," - Used internally by the frontend for specific Linux distributions"]}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Note"}),": Docker pulls these images automatically when you run builds. You don't reference them directly in your Dockerfile, but you should verify them before first use."]}),"\n",(0,t.jsxs)(i.p,{children:["Images are signed using ",(0,t.jsx)(i.a,{href:"https://github.com/sigstore/cosign",children:"Sigstore's cosign"})," with keyless signing via GitHub OIDC tokens."]}),"\n",(0,t.jsx)(i.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(i.p,{children:"To verify images, you can use either:"}),"\n",(0,t.jsx)(i.h3,{id:"option-1-cosign-recommended",children:"Option 1: Cosign (Recommended)"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:'# Install cosign (see https://docs.sigstore.dev/cosign/installation for more options)\nbrew install cosign\n# or\nARCH=$(uname -m)\ncurl -O -L "https://github.com/sigstore/cosign/releases/latest/download/cosign-linux-${ARCH}"\nsudo mv cosign-linux-${ARCH} /usr/local/bin/cosign\nsudo chmod +x /usr/local/bin/cosign\n'})}),"\n",(0,t.jsx)(i.h3,{id:"option-2-github-cli",children:"Option 2: GitHub CLI"}),"\n",(0,t.jsxs)(i.p,{children:["If you have the ",(0,t.jsx)(i.a,{href:"https://cli.github.com/",children:"GitHub CLI"})," installed (v2.49.0+), you can use the built-in attestation verification:"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"export VERSION=v0.19.0\ngh attestation verify oci://ghcr.io/project-dalec/dalec/frontend:$VERSION --owner project-dalec\n"})}),"\n",(0,t.jsx)(i.p,{children:"This guide primarily uses cosign for detailed examples, but GitHub CLI is simpler for basic verification."}),"\n",(0,t.jsx)(i.h2,{id:"verifying-image-signatures",children:"Verifying Image Signatures"}),"\n",(0,t.jsx)(i.h3,{id:"verify-frontend-image",children:"Verify Frontend Image"}),"\n",(0,t.jsx)(i.p,{children:"To verify a specific release of the frontend image:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"export VERSION=v0.19.0\ncosign verify ghcr.io/project-dalec/dalec/frontend:$VERSION \\\n  --certificate-oidc-issuer https://token.actions.githubusercontent.com \\\n  --certificate-identity https://github.com/project-dalec/dalec/.github/workflows/frontend-image.yml@refs/tags/$VERSION\n"})}),"\n",(0,t.jsx)(i.p,{children:"To verify the latest release:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"cosign verify ghcr.io/project-dalec/dalec/frontend:latest \\\n  --certificate-oidc-issuer https://token.actions.githubusercontent.com \\\n  --certificate-identity-regexp 'https://github.com/project-dalec/dalec/.github/workflows/frontend-image.yml@refs/tags/v.*'\n"})}),"\n",(0,t.jsx)(i.h3,{id:"verify-worker-images",children:"Verify Worker Images"}),"\n",(0,t.jsx)(i.p,{children:"Worker images follow a similar pattern:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"export VERSION=v0.19.0\ncosign verify ghcr.io/project-dalec/dalec/noble/worker:$VERSION \\\n  --certificate-oidc-issuer https://token.actions.githubusercontent.com \\\n  --certificate-identity https://github.com/project-dalec/dalec/.github/workflows/worker-images.yml@refs/tags/$VERSION\n"})}),"\n",(0,t.jsx)(i.h3,{id:"understanding-the-output",children:"Understanding the Output"}),"\n",(0,t.jsx)(i.p,{children:"A successful verification will output JSON containing the signature details:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-json",children:'[\n  {\n    "critical": {\n      "identity": {\n        "docker-reference": "ghcr.io/project-dalec/dalec/frontend"\n      },\n      "image": {\n        "docker-manifest-digest": "sha256:abc123..."\n      },\n      "type": "cosign container image signature"\n    },\n    "optional": {\n      "Bundle": {\n        "SignedEntryTimestamp": "...",\n        "Payload": {\n          "body": "...",\n          "integratedTime": 1234567890,\n          "logIndex": 12345678,\n          "logID": "..."\n        }\n      }\n    }\n  }\n]\n'})}),"\n",(0,t.jsx)(i.p,{children:"If verification fails, you'll see an error message such as:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{children:"Error: no matching signatures\n"})}),"\n",(0,t.jsx)(i.p,{children:"This could mean:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"The image hasn't been signed (e.g., development builds)"}),"\n",(0,t.jsx)(i.li,{children:"The image has been tampered with"}),"\n",(0,t.jsx)(i.li,{children:"The image was built by a different workflow or repository"}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"verifying-build-provenance",children:"Verifying Build Provenance"}),"\n",(0,t.jsx)(i.p,{children:"In addition to signatures, release images include SLSA provenance attestations that document how the image was built."}),"\n",(0,t.jsx)(i.h3,{id:"view-provenance-attestation",children:"View Provenance Attestation"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"# View build provenance attestation for an image\nexport VERSION=v0.19.0\ncosign verify-attestation ghcr.io/project-dalec/dalec/frontend:$VERSION \\\n  --certificate-oidc-issuer https://token.actions.githubusercontent.com \\\n  --certificate-identity https://github.com/project-dalec/dalec/.github/workflows/frontend-image.yml@refs/tags/$VERSION \\\n  --type https://slsa.dev/provenance/v1 | jq\n"})}),"\n",(0,t.jsx)(i.p,{children:"The provenance includes:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Source repository and commit SHA"}),"\n",(0,t.jsx)(i.li,{children:"GitHub Actions workflow that built the image"}),"\n",(0,t.jsx)(i.li,{children:"Build parameters and environment"}),"\n",(0,t.jsx)(i.li,{children:"Timestamps and builder information"}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"You can also use the GitHub CLI to view attestations:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"export VERSION=v0.19.0\ngh attestation verify oci://ghcr.io/project-dalec/dalec/frontend:$VERSION --owner project-dalec\n"})}),"\n",(0,t.jsx)(i.h3,{id:"viewing-sbom-software-bill-of-materials",children:"Viewing SBOM (Software Bill of Materials)"}),"\n",(0,t.jsxs)(i.p,{children:["Images built with the ",(0,t.jsx)(i.code,{children:"docker/build-push-action"})," include an SBOM attestation that lists all software components:"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"# View SBOM attestation\nexport VERSION=v0.19.0\ncosign verify-attestation ghcr.io/project-dalec/dalec/frontend:$VERSION \\\n  --certificate-oidc-issuer https://token.actions.githubusercontent.com \\\n  --certificate-identity https://github.com/project-dalec/dalec/.github/workflows/frontend-image.yml@refs/tags/$VERSION \\\n  --type https://spdx.dev/Document | jq\n"})}),"\n",(0,t.jsx)(i.p,{children:"Alternatively, you can use Docker's built-in SBOM viewer:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"export VERSION=v0.19.0\ndocker buildx imagetools inspect ghcr.io/project-dalec/dalec/frontend:$VERSION --format '{{json .}}' | jq '.sbom'\n"})}),"\n",(0,t.jsx)(i.h2,{id:"automated-verification-in-cicd",children:"Automated Verification in CI/CD"}),"\n",(0,t.jsx)(i.p,{children:"For production use, you should verify Dalec images in your CI/CD pipeline before building packages. This ensures every build uses verified, official Dalec releases."}),"\n",(0,t.jsx)(i.h3,{id:"github-actions-example",children:"GitHub Actions Example"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-yaml",children:'jobs:\n  build-packages:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      \n      - name: Install Cosign\n        uses: sigstore/cosign-installer@v3.7.0\n      \n      - name: Verify Dalec Frontend Image\n        env:\n          VERSION: v0.19.0\n        run: |\n          # Verify the Dalec version you\'re about to use\n          cosign verify ghcr.io/project-dalec/dalec/frontend:$VERSION \\\n            --certificate-oidc-issuer https://token.actions.githubusercontent.com \\\n            --certificate-identity https://github.com/project-dalec/dalec/.github/workflows/frontend-image.yml@refs/tags/$VERSION\n          \n          echo "Dalec frontend image verified successfully"\n      \n      - name: Build Package with Dalec\n        run: |\n          # Now safely use Dalec to build your package\n          docker build -f my-package.yml --target mariner2/rpm -o ./output .\n'})}),"\n",(0,t.jsx)(i.h3,{id:"gitlab-ci-example",children:"GitLab CI Example"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-yaml",children:"verify-dalec:\n  stage: verify\n  image: alpine:latest\n  variables:\n    VERSION: v0.19.0\n  before_script:\n    - apk add --no-cache cosign\n  script:\n    - |\n      cosign verify ghcr.io/project-dalec/dalec/frontend:$VERSION \\\n        --certificate-oidc-issuer https://token.actions.githubusercontent.com \\\n        --certificate-identity https://github.com/project-dalec/dalec/.github/workflows/frontend-image.yml@refs/tags/$VERSION\n  \nbuild-package:\n  stage: build\n  needs: [verify-dalec]\n  script:\n    - docker build -f my-package.yml --target mariner2/rpm -o ./output .\n"})}),"\n",(0,t.jsx)(i.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Pin versions"}),": Always specify exact version tags (e.g., ",(0,t.jsx)(i.code,{children:"v0.19.0"}),") rather than ",(0,t.jsx)(i.code,{children:"latest"})]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Verify early"}),": Add verification as one of the first steps in your pipeline"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Fail fast"}),": If verification fails, stop the pipeline immediately"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Audit logs"}),": Save verification results for compliance and debugging"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Update carefully"}),": When updating Dalec versions, verify the new version before deploying"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"development-vs-release-images",children:"Development vs. Release Images"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Important"}),": Only tagged release images are signed. Images built from:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Pull requests"}),"\n",(0,t.jsxs)(i.li,{children:["Branch commits (including ",(0,t.jsx)(i.code,{children:"main"}),")"]}),"\n",(0,t.jsx)(i.li,{children:"Local development builds"}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["...are ",(0,t.jsx)(i.strong,{children:"NOT signed"})," and verification will fail. This is intentional to ensure only official releases are signed."]}),"\n",(0,t.jsx)(i.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,t.jsx)(i.p,{children:"For more information about image signing and verification:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Troubleshooting verification issues"}),": See the ",(0,t.jsx)(i.a,{href:"https://docs.sigstore.dev/cosign/verifying/verify/",children:"Cosign verify documentation"})]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Understanding keyless signing"}),": See the ",(0,t.jsx)(i.a,{href:"https://docs.sigstore.dev/signing/overview/",children:"Sigstore keyless signing overview"})]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Signing packages with Dalec"}),": See ",(0,t.jsx)(i.a,{href:"/dalec/signing",children:"Signing Packages"})," for signing RPM/DEB packages built with Dalec"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"SLSA provenance"}),": Learn more about ",(0,t.jsx)(i.a,{href:"https://slsa.dev/",children:"SLSA Framework"})," and supply chain security"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>a,x:()=>c});var s=n(6540);const t={},r=s.createContext(t);function a(e){const i=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:i},e.children)}}}]);